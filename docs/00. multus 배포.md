## Multus 소개

## MACVLAN 소개

## IPVLAN과의 차이


## Multus 설치
해당 작업은 master 노드 또는 kubernetes cluster를 제어할 수 있는 클라이언트에서 작업한다.

Kuberenetes Cluster 정보
```
kubectl get node -owide
NAME       STATUS   ROLES                  AGE   VERSION   INTERNAL-IP      EXTERNAL-IP   OS-IMAGE             KERNEL-VERSION     CONTAINER-RUNTIME
master01   Ready    control-plane,master   22h   v1.23.4   172.27.100.10    <none>        Ubuntu 20.04.2 LTS   5.4.0-65-generic   containerd://1.4.12
worker01   Ready    <none>                 22h   v1.23.4   172.27.100.101   <none>        Ubuntu 20.04.2 LTS   5.4.0-65-generic   containerd://1.4.12
worker02   Ready    <none>                 22h   v1.23.4   172.27.100.102   <none>        Ubuntu 20.04.2 LTS   5.4.0-65-generic   containerd://1.4.12

kubectl get pod -n kube-system
NAME                                       READY   STATUS    RESTARTS      AGE
calico-kube-controllers-56fcbf9d6b-nqbr8   1/1     Running   0             7m23s
calico-node-5zfxb                          1/1     Running   0             7m23s
calico-node-6klcc                          1/1     Running   0             7m23s
calico-node-gvllk                          1/1     Running   0             7m23s
coredns-64897985d-dkvpk                    1/1     Running   0             22h
coredns-64897985d-z2pjg                    1/1     Running   0             22h
haproxy-master01                           1/1     Running   1 (16m ago)   22h
kube-apiserver-master01                    1/1     Running   1 (16m ago)   22h
kube-controller-manager-master01           1/1     Running   1 (16m ago)   22h
kube-proxy-5mfv7                           1/1     Running   1 (16m ago)   22h
kube-proxy-gwvxs                           1/1     Running   1 (16m ago)   22h
kube-proxy-w8j4b                           1/1     Running   1 (16m ago)   22h
kube-scheduler-master01                    1/1     Running   1 (16m ago)   22h
```

```

git clone https://github.com/k8snetworkplumbingwg/multus-cni.git && cd multus-cni
cat ./deployments/multus-daemonset-thick-plugin.yml | kubectl apply -f -

kubectl get pod -n kube-system -l app=multus
NAME                   READY   STATUS    RESTARTS   AGE
kube-multus-ds-dnd6z   1/1     Running   0          91s
kube-multus-ds-dz789   1/1     Running   0          91s
kube-multus-ds-xsnp9   1/1     Running   0          91s

```

Daemonset으로 multus를 배포하면 /etc/cni/net.d/ 디렉터리 밑에 '00-multus.conf' 파일과 'multus.d' 디렉터리와 이 디렉터리 밑에 'multus.kubeconfig' 파일이 자동으로 생성된다.

```
sudo cat /etc/cni/net.d/00-multus.conf | jq
{
  "capabilities": {
    "bandwidth": true,
    "portMappings": true
  },
  "cniVersion": "0.3.1",
  "delegates": [
    {
      "cniVersion": "0.3.1",
      "name": "k8s-pod-network",
      "plugins": [
        {
          "datastore_type": "kubernetes",
          "ipam": {
            "type": "calico-ipam"
          },
          "kubernetes": {
            "kubeconfig": "/etc/cni/net.d/calico-kubeconfig"
          },
          "log_file_path": "/var/log/calico/cni/cni.log",
          "log_level": "info",
          "mtu": 0,
          "nodename": "master01",
          "policy": {
            "type": "k8s"
          },
          "type": "calico"
        },
        {
          "capabilities": {
            "portMappings": true
          },
          "snat": true,
          "type": "portmap"
        },
        {
          "capabilities": {
            "bandwidth": true
          },
          "type": "bandwidth"
        }
      ]
    }
  ],
  "logLevel": "verbose",
  "logToStderr": true,
  "kubeconfig": "/etc/cni/net.d/multus.d/multus.kubeconfig",
  "name": "multus-cni-network",
  "type": "multus"
}

```


